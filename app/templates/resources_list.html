{% extends "base.html" %}

{% block title %}èµ„æºç´¢å¼• - {{ site_config.title }}{% endblock %}

{% block content %}
<section>
  <h2>èµ„æºç´¢å¼•</h2>
  <p>è¿™é‡Œæ˜¯ä¸ä½œå“æ ‡ç­¾å®Œå…¨éš”ç¦»çš„èµ„æºåˆ†å‘åŒºï¼Œç”¨äºæ•´ç†å„ç§æœ¬ä½“ã€è¡¥ä¸ã€OST ç­‰ä¸‹è½½ä¿¡æ¯ã€‚</p>

  <form method="get" class="grid" style="align-items: flex-end; gap: 0.75rem;">
    <div>
      <label for="q">æœç´¢å…³é”®è¯</label>
      <input type="search" id="q" name="q" placeholder="æŒ‰æ ‡é¢˜æˆ–æ ‡ç­¾æœç´¢" value="{{ q }}">
    </div>
    <div>
      <label for="tag">æ ‡ç­¾ç­›é€‰</label>
      <select id="tag" name="tag">
        <option value="">å…¨éƒ¨æ ‡ç­¾</option>
        {% for item in popular_tags %}
          <option value="{{ item.tag.name }}" {% if active_tag == item.tag.name %}selected{% endif %}>
            {{ item.tag.name }} ({{ item.count }})
          </option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>&nbsp;</label>
      <button type="submit">ç­›é€‰</button>
    </div>
    <div style="text-align:right;">
      <label>&nbsp;</label>
      <a href="/resources/submit" role="button" class="secondary">æäº¤æ–°èµ„æº</a>
    </div>
  </form>

  <small>å…± {{ total_count }} ä¸ªèµ„æºï¼Œå½“å‰ç¬¬ {{ page }} / {{ total_pages }} é¡µ</small>

  <table role="grid">
    <thead>
      <tr>
        <th style="width:5rem;">çƒ­åº¦</th>
        <th>æ ‡é¢˜</th>
        <th style="width:8rem;">åˆ†ç±»</th>
        <th style="width:10rem;">æ ‡ç­¾</th>
        <th style="width:7rem;">çŠ¶æ€</th>
        <th style="width:9rem;">ä¸Šä¼ è€…</th>
        <th style="width:8rem;">æ—¶é—´</th>
      </tr>
    </thead>
    <tbody>
      {% for res in resources %}
      <tr>
        <td>
          <span class="badge {% if res.heat > 0 %}contrast{% elif res.heat < 0 %}secondary outline{% endif %}">
            {{ res.heat }}
          </span>
        </td>
        <td>
          <a href="/resources/{{ res.id }}">{{ res.title }}</a>
        </td>
        <td>
          <small>{{ res.category }}</small>
        </td>
        <td>
          {% for tag in res.tags[:3] %}
            <a href="/resources?tag={{ tag.name | urlencode }}" class="secondary outline" style="margin-right: .25rem; font-size: .75rem;">
              {{ tag.name }}
            </a>
          {% endfor %}
          {% if res.tags|length > 3 %}
            <small>+{{ res.tags|length - 3 }}</small>
          {% endif %}
        </td>
        <td>
          {% if res.status == "valid" %}
            <span class="badge">ğŸŸ¢ æœ‰æ•ˆ</span>
          {% else %}
            <span class="badge secondary outline">ğŸ”´ å¤±æ•ˆ</span>
          {% endif %}
        </td>
        <td>
          {% if res.uploader %}
            <a href="/user/{{ res.uploader.id }}">{{ res.uploader.username }}</a>
          {% else %}
            <small>å·²åˆ é™¤ç”¨æˆ·</small>
          {% endif %}
        </td>
        <td>
          <small>{{ res.created_at.strftime("%Y-%m-%d") if res.created_at else "" }}</small>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7"><small>æš‚æ— èµ„æºã€‚</small></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if total_pages > 1 %}
  <nav aria-label="èµ„æºåˆ†é¡µ" style="margin-top: 1rem; display:flex; justify-content:center; gap:.5rem;">
    {% set base_q = '&q=' + q if q else '' %}
    {% set base_tag = '&tag=' + active_tag if active_tag else '' %}
    <a href="/resources?page={{ [1, page-1]|max }}{{ base_q }}{{ base_tag }}" role="button" class="secondary" {% if page == 1 %}aria-disabled="true"{% endif %}>
      ä¸Šä¸€é¡µ
    </a>
    <span style="align-self:center;">ç¬¬ {{ page }} / {{ total_pages }} é¡µ</span>
    <a href="/resources?page={{ [total_pages, page+1]|min }}{{ base_q }}{{ base_tag }}" role="button" class="secondary" {% if page >= total_pages %}aria-disabled="true"{% endif %}>
      ä¸‹ä¸€é¡µ
    </a>
  </nav>
  {% endif %}
</section>
{% endblock %}


