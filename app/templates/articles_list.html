{% extends "base.html" %}

{% block title %}文章/专栏{% endblock %}

{% block content %}
<h2><i data-lucide="book-open"></i> 文章/专栏</h2>
<p>仅管理员可发布，访客可浏览。</p>

{% if request.state.user and request.state.user.is_admin %}
<p><a href="/admin/articles/new" role="button" class="contrast outline">新建文章</a></p>
{% endif %}

{% if articles %}
<div class="grid articles-list" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
  {% for a in articles %}
  {% set is_static = a.static_path and (not a.content_md or not a.content_md.strip()) %}
  {% set is_mixed = a.static_path and a.content_md and a.content_md.strip() %}
  {% set mode_label = '纯静态' if is_static else ('混合' if is_mixed else '纯文本') %}
  <article class="card" style="border:1px solid var(--pico-muted-border-color); padding:1rem; border-radius: var(--pico-border-radius); height:100%; display:flex; flex-direction:column; gap:0.5rem;">
    <div>
      <div style="display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap;">
        <a href="{% if is_static %}/article/{{ a.slug }}/static{% else %}/article/{{ a.slug }}{% endif %}" style="font-weight:700; font-size:1.05rem;">{{ a.title }}</a>
        <span class="tag-badge">{{ mode_label }}</span>
        {% if is_static and request.state.user and request.state.user.is_admin %}
        <a href="/admin/articles/{{ a.id }}/edit" style="font-size: 0.8rem; padding: 0.1rem 0.4rem; border:1px solid var(--pico-muted-border-color); border-radius: var(--pico-border-radius); color: var(--pico-muted-color);">编辑</a>
        {% endif %}
      </div>
      <small style="color: var(--pico-muted-color);">
        作者 {% if a.author %}<a href="/user/{{ a.author.id }}">{{ a.author.username }}</a>{% else %}管理员{% endif %} · {{ a.created_at.strftime('%Y-%m-%d') }}
      </small>
    </div>

    {% if a.content_md and a.content_md.strip() %}
    <p style="color: var(--pico-muted-color); margin:0;">{{ a.content_md[:120].replace('\n',' ') }}{% if a.content_md|length > 120 %}...{% endif %}</p>
    {% endif %}

    <div style="margin-top:auto; display:flex; gap:0.5rem; flex-wrap:wrap;">
      {# 按钮区域：纯静态不再需要“打开文档”按钮，点击标题即可；纯文本/混合也可省略按钮，如需保留可加回 #}
    </div>
  </article>
  {% endfor %}
</div>
{% else %}
<p>暂无文章。</p>
{% endif %}
{% endblock %}

